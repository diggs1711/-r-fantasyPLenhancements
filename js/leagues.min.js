!function(){let userId=0,loggedInUserUrl="https://fantasy.premierleague.com/drf/bootstrap-dynamic",userMainUrl="https://fantasy.premierleague.com/drf/my-team/",liveDataUrl="https://fantasy.premierleague.com/drf/event/",playerHistoryUrl="https://fantasy.premierleague.com/drf/entry/",leaguesBody=document.querySelectorAll(".live-leagues-body")[0];const latestPicksBaseUrl="https://fantasy.premierleague.com/drf/entry/",liveLeaguesTable=document.querySelectorAll(".live-leagues-table")[0],leagueUrl="https://fantasy.premierleague.com/drf/leagues-classic-standings/",classicLeagueBody=document.querySelectorAll(".live-classic-league-body")[0],classicLeagueDiv=document.querySelectorAll(".classic-leagues")[0],backToLeagueListBtn=document.querySelectorAll(".league-back-btn")[0],leagesDiv=document.querySelectorAll(".live-leagues")[0],leagueName=document.querySelectorAll(".league-name")[0];backToLeagueListBtn.addEventListener("click",event=>{classicLeagueDiv.classList.add("hidden"),liveLeaguesTable.classList.remove("hidden"),liveLeaguesTable.classList.remove("animated"),liveLeaguesTable.classList.remove("fadeOutDown")});let requestData=Url=>new Promise(function(resolve,reject){let xhr=new XMLHttpRequest;xhr.open("GET",Url,!0),xhr.onload=function(){4===xhr.readyState&&(200===xhr.status?resolve(JSON.parse(xhr.responseText)):reject(Error(xhr.statusText)))},xhr.send(null)}),userPromise;async function openMiniLeagueTable(league,currentGameweek){let leagueDataPromise=requestData(leagueUrl+league.id);liveLeaguesTable.classList.add("animated","fadeOutDown"),leagueDataPromise.then(async function(result){leagueName.innerHTML="",leagueName.appendChild(document.createTextNode(result.league.name));let liveData,livePlayerData=(await getLiveData(currentGameweek)).elements,league=result.standings.results.map(function(player){return{name:player.entry_name,rank:player.rank,total:player.total,entry_id:player.entry,gameweek_points:player.event_total}});liveLeaguesTable.classList.add("hidden"),classicLeagueBody.innerHTML="";let latestPicksPromises=[],previousGameweekPromises=[],leaguePlayers=[];league.forEach(function(player){latestPicksPromises.push(requestData(latestPicksBaseUrl+"/"+player.entry_id+"/event/"+currentGameweek+"/picks")),leaguePlayers.push(player),previousGameweekPromises.push(requestData(playerHistoryUrl+player.entry_id+"/history"))}),Promise.all(latestPicksPromises).then(function(players){players.forEach(function(result,index){let currPlayer=leaguePlayers[index],playerPicks=result.picks,latestPlayerPoints=0;currPlayer.gameweek_transfers=result.entry_history.event_transfers,currPlayer.transfer_cost=0-result.entry_history.event_transfers_cost,playerPicks.forEach(function(pick){if("bboost"===result.active_chip||pick.position<=11){let playerElementId=pick.element,totalPlayerPoints=livePlayerData[playerElementId].stats.total_points*pick.multiplier;latestPlayerPoints+=totalPlayerPoints}if(pick.multiplier>1){let captain=window.playerData.find(function(player){return player.id===pick.element});currPlayer.captain=captain.name}}),console.log(currPlayer),currPlayer.chip=result.active_chip,currPlayer.gameweek_points=latestPlayerPoints-result.entry_history.event_transfers_cost,leaguePlayers[index]=currPlayer}),Promise.all(previousGameweekPromises).then(function(result){result.forEach(function(player){let playerId=player.entry.id,totalPointsLastWeek=player.history.find(function(gameweek){return gameweek.event===currentGameweek-1}).total_points,p=leaguePlayers.find(function(p){return p.entry_id===playerId});p.total_points=totalPointsLastWeek+p.gameweek_points}),leaguePlayers.sort((a,b)=>b.total-a.total),classicLeagueBody.innerHTML="";let previousRank=0,previousPoints=0;leaguePlayers.forEach(function(player,index){previousPoints===player.total?player.rank=previousRank:(previousRank=index+1,player.rank=previousRank),previousPoints=player.total;let row=document.createElement("tr");for(const key in player)if(player.hasOwnProperty(key)&&"entry_id"!=key){const element=player[key];let cell=document.createElement("td");cell.classList.add("league-player"),cell.appendChild(document.createTextNode(element)),row.appendChild(cell)}classicLeagueBody.appendChild(row),classicLeagueDiv.classList.remove("hidden")})})})})}requestData(loggedInUserUrl).then(async function(result){if(null===result.entry)return void leagesDiv.appendChild(document.createTextNode("YOU MUST BE LOGGED IN ON THE MAIN FPL SITE TO VIEW LIVE LEAGUE DATA"));let currentGameweek=result.entry.current_event,userUrl;var userDataPromise;userId=result.entry.id,requestData(userMainUrl+userId).then(function(result){let leagues;result.leagues.classic.map(function(league){return{name:league.name,rank:league.entry_rank,id:league.id}}).forEach(league=>{let row=document.createElement("tr");for(const key in league)if(league.hasOwnProperty(key)&&"id"!==key){const element=league[key];let cell=document.createElement("td");cell.classList.add("league"),cell.appendChild(document.createTextNode(element)),row.appendChild(cell),cell.addEventListener("click",openMiniLeagueTable.bind(this,league,currentGameweek))}leaguesBody.appendChild(row)})})});let getLiveData=function(currGameweek){return requestData(liveDataUrl+currGameweek+"/live")}}();